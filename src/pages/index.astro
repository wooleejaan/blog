---
import BaseHead from '../libs/blog/BaseHead.astro'
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts'
import PageLayoutWithHeader from '../libs/shared/components/PageLayoutWithHeader/PageLayoutWithHeader'
import PageSection from '../libs/shared/components/PageSection/PageSection'
import { getCollection } from 'astro:content'
import BlogList from '../libs/blog/BlogList.astro'
import HomeHero from '../libs/home/HomeHero.astro'

const { pathname } = Astro.url
const subpath = pathname.match(/[^\/]+/g)
const baseHref = '/'
const isHome = baseHref === pathname || baseHref === '/' + subpath?.[0]

const notes = (await getCollection('note')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)

const engineerings = (await getCollection('engineering')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)

const collections = (await getCollection('collection')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)

if (!engineerings || !notes || !collections) {
  return Astro.redirect('/404')
}
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <PageLayoutWithHeader title="yongwoo" client:idle isHomePage={isHome}>
      <PageSection disableTitleMarginBottom>
        <HomeHero />
        <!-- <BlogList items={notes} title="note" pathName="note" /> -->
        <BlogList
          items={engineerings}
          title="engineering"
          pathName="engineering"
        />
        <BlogList
          items={collections}
          title="collection"
          pathName="collection"
        />
      </PageSection>
    </PageLayoutWithHeader>
  </body>
</html>
